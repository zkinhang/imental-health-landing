<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Wellness Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s ease-in-out;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        /* Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 24px;
            border: 1px solid #888;
            width: 90%;
            max-width: 700px;
            border-radius: 12px;
            animation: slideIn 0.3s;
        }
        .modal-close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .modal-close:hover,
        .modal-close:focus {
            color: black;
        }

        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
        @keyframes slideIn { from {transform: translateY(-50px);} to {transform: translateY(0);} }

    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        <!-- Header -->
        <header class="mb-8">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">Weekly Wellness Report</h1>
            <p class="text-gray-500 mt-1" id="report-date">For the week of Sep 16 - Sep 22, 2025</p>
        </header>

        <!-- Main content grid -->
        <main id="report-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Report cards will be inserted here by JavaScript -->
        </main>

        <!-- About This Report Section -->
        <section class="mt-12 bg-white p-6 rounded-xl shadow-md">
            <h2 class="text-xl font-bold text-gray-900 mb-4">About This Report</h2>
            <ul class="space-y-3 text-sm text-gray-700 list-disc list-inside">
                <li>
                    <strong>Specialized AI Model:</strong> This report uses a fine-tuned AI model trained on data from professionals with profiles similar to yours.
                </li>
                <li>
                    <strong>Instant Reliability:</strong> Get highly reliable predictions from day one, without needing a large amount of your personal data to be effective.
                </li>
                <li>
                    <strong>Proactive Alerts:</strong> When your status shows patterns common to your professional group that may indicate a future risk, the app can provide an alert in advance.
                </li>
            </ul>
        </section>

        <!-- Footer/Disclaimer -->
        <footer class="mt-12 text-center">
            <p class="text-xs text-gray-500">This report is for informational purposes only and is not a substitute for professional medical advice. Consult with a healthcare provider for any health concerns.</p>
        </footer>
    </div>

    <!-- Chart Modal -->
    <div id="chartModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h2 id="chartModalTitle" class="text-xl font-bold mb-4"></h2>
            <div>
                <canvas id="historyChart"></canvas>
            </div>
             <!-- AI/Forecast Analysis -->
             <div id="forecast-analysis-container" class="mt-4 text-left text-sm" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Mock data for the user's weekly wellness report with history and threshold ranges
        const reportData = [
            {
                metric: "Sleep Quality",
                icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 21a9 9 0 1 1 0-18 9 9 0 0 1 0 18Z"/><path d="M8 11.5a2.5 2.5 0 0 1 0-3 2.5 2.5 0 0 1 0 3Z"/><path d="M16 11.5a2.5 2.5 0 0 1 0-3 2.5 2.5 0 0 1 0 3Z"/><path d="M12 16a4 4 0 0 0 0-8"/></svg>`,
                userScore: 65,
                avgScore: 82,
                previousScore: 78,
                unit: "Score",
                threshold: [70, 95],
                analysis: "A sharp drop in sleep quality this week resulted in a score much lower than forecasted.",
                warning: "Score is below recommended range. Prioritizing consistent sleep is crucial for recovery.",
                discrepancyWarning: "Your sleep was much worse than the predicted recovery, indicating a persistent negative trend.",
                history: [78, 80, 75, 79, 72, 76, 78, 65, 62],
                previousForecast: [null, null, null, null, null, null, 77, 78, 70]
            },
            {
                metric: "Physical Activity",
                icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12.55a11 11 0 0 1 14 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" x2="12" y1="20" y2="22"/><line x1="2" x2="4" y1="12" y2="12"/><line x1="20" x2="22" y1="12" y2="12"/></svg>`,
                userScore: 58,
                avgScore: 70,
                previousScore: 60,
                unit: "Score",
                threshold: [60, 95],
                analysis: "Your activity levels have slowly declined over the past few weeks and have now fallen just below the healthy range.",
                warning: "Activity score is below recommended range. Fatigue or changes in routine may be a factor.",
                discrepancyWarning: null,
                history: [70, 68, 69, 65, 64, 62, 60, 58],
                previousForecast: [null, null, null, null, null, 63, 61, 59]
            },
            {
                metric: "Word Used",
                icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>`,
                userScore: 71,
                avgScore: 75,
                previousScore: 72,
                unit: "Positivity Score",
                threshold: [70, 95],
                analysis: "Your positivity score, while still healthy, has continued a subtle downward trend over the last several weeks.",
                warning: null, 
                discrepancyWarning: null,
                history: [78, 77, 78, 76, 75, 74, 72, 71],
                previousForecast: [null, null, null, null, null, 74, 73, 72]
            },
            {
                metric: "Blood Pressure",
                icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-2.5-3.5-2.5-1.5 1-3.5 2.5-3 3.5-3 5.5a7 7 0 0 0 7 7Z"/><path d="M12 15a3 3 0 0 0 3-3c0-1.2-1.5-3-3-3s-3 1.8-3 3a3 3 0 0 0 3 3Z"/></svg>`,
                userScore: '122/81',
                avgScore: '120/80',
                previousScore: '121/79',
                unit: "mmHg",
                threshold: [90, 120],
                analysis: "Your blood pressure has slightly increased this week, moving into the elevated range. This may be related to recent stress or changes in sleep.",
                warning: "Blood pressure is now in the elevated range. It's important to monitor this, especially after stressful periods.",
                discrepancyWarning: null,
                history: [120, 122, 119, 121, 118, 120, 121, 122],
                previousForecast: [null, null, null, null, null, 120, 121, 121]
            }
           
        ];
        
        let historyChartInstance = null; 

        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.getElementById('report-grid');
            reportData.forEach(item => {
                const card = createReportCard(item);
                grid.innerHTML += card;
            });
            animateProgressBars();
        });
        
        // --- Analysis Functions ---
        function getForecastDiscrepancyAnalysis(metricData) {
            const { history, previousForecast, discrepancyWarning } = metricData;
            if (!discrepancyWarning) return null;

            const actualThisWeek = history[7];
            const forecastForThisWeek = previousForecast ? previousForecast[7] : null;

            if (actualThisWeek !== null && forecastForThisWeek !== null) {
                const diff = actualThisWeek - forecastForThisWeek;
                if (Math.abs(diff / forecastForThisWeek) > 0.15) {
                    return {
                        text: discrepancyWarning,
                        isPositive: diff > 0
                    };
                }
            }
            return null;
        }


        function getForecastAnalysis(metricData) {
            const { history, threshold } = metricData;
            let futureAlert = '';

            if (history && history.length >= 2 && typeof history[0] === 'number') {
                const lastValue = history[history.length - 1];
                const secondLastValue = history[history.length - 2];
                const trend = lastValue - secondLastValue;
                
                const futureForecastValues = [
                    Math.round(lastValue + trend),
                    Math.round(lastValue + 2 * trend),
                    Math.round(lastValue + 3 * trend)
                ];

                const isDownwardTrend = futureForecastValues.every((v, i, a) => i === 0 || v < a[i-1]);
                let isOutsideRange = false;
                let outsideRangeMessage = '';

                if (threshold && Array.isArray(threshold)) {
                    if (futureForecastValues.some(v => v < threshold[0])) {
                        isOutsideRange = true;
                        outsideRangeMessage = "fall below healthy range.";
                    } else if (futureForecastValues.some(v => v > threshold[1])) {
                        isOutsideRange = true;
                        outsideRangeMessage = "rise above healthy range.";
                    }
                }
                
                if (isDownwardTrend && isOutsideRange) {
                    futureAlert = `Forecast shows downward trend, predicted to ${outsideRangeMessage}`;
                } else if (isDownwardTrend) {
                    futureAlert = `Forecast shows a continuing downward trend. Close monitoring recommended.`;
                } else if (isOutsideRange) {
                    futureAlert = `Forecast predicts metric will ${outsideRangeMessage}`;
                }
            }
            return futureAlert;
        }

        // --- Charting and Modal ---
        const modal = document.getElementById('chartModal');
        const modalTitle = document.getElementById('chartModalTitle');
        const forecastAnalysisContainer = document.getElementById('forecast-analysis-container');

        function showHistoryChart(metricName) {
            const metricData = reportData.find(d => d.metric === metricName);
            if (!metricData || !metricData.history) return;

            modalTitle.innerText = `${metricData.metric} - History & Forecast`;
            const ctx = document.getElementById('historyChart').getContext('2d');
            if(historyChartInstance) historyChartInstance.destroy();

            const history = metricData.history;
            const previousForecastData = metricData.previousForecast;

            let futureForecastData = [];
            if (history && history.length >= 2 && typeof history[0] === 'number') {
                const lastValue = history[history.length - 1];
                const secondLastValue = history[history.length - 2];
                const trend = lastValue - secondLastValue;
                const futureValues = [
                    Math.round(lastValue + trend),
                    Math.round(lastValue + 2 * trend),
                    Math.round(lastValue + 3 * trend)
                ];
                futureForecastData = [...Array(history.length - 1).fill(null), lastValue, ...futureValues];
            }
            
            const chartLabels = [...Array.from({ length: 8 }, (_, i) => `Wk ${i}`), 'Wk 8', 'Wk 9', 'Wk 10'];
            let datasets = [
                { label: `Your ${metricData.unit}`, data: history, borderColor: '#4f46e5', backgroundColor: 'rgba(79, 70, 229, 0.1)', fill: true, tension: 0.3, order: 1 },
                { label: `Previous Forecast`, data: previousForecastData, borderColor: '#6b7280', borderDash: [2, 2], fill: false, tension: 0.3, order: 2 },
                { label: `Future Forecast`, data: futureForecastData, borderColor: '#f97316', borderDash: [5, 5], fill: false, tension: 0.3, order: 2 }
            ];

            if (metricData.threshold && Array.isArray(metricData.threshold)) {
                datasets.push({
                    label: 'Healthy Range',
                    data: Array(history.length + 3).fill(metricData.threshold[1]),
                    borderColor: 'transparent', pointRadius: 0,
                    fill: { target: { value: metricData.threshold[0] }, above: 'rgba(34, 197, 94, 0.1)' },
                    order: 3
                });
            }

            historyChartInstance = new Chart(ctx, {
                type: 'line', data: { labels: chartLabels, datasets: datasets },
                options: { responsive: true, plugins: { legend: { position: 'top' } }, scales: { y: { beginAtZero: false, title: { display: true, text: metricData.unit } } } }
            });

            let analysisHTML = '';
            const forecastForThisWeek = previousForecastData ? previousForecastData[7] : null;
            const actualThisWeek = history[7];
            
            const discrepancyAlert = getForecastDiscrepancyAnalysis(metricData);
            if (discrepancyAlert) {
                if (discrepancyAlert.isPositive) {
                    analysisHTML += `<div class="bg-green-50 border border-green-200 text-green-800 p-3 rounded-lg mb-3"><p class="font-bold">✅ Positive Forecast</p><p>${discrepancyAlert.text}</p></div>`;
                } else {
                    analysisHTML += `<div class="bg-red-50 border border-red-200 text-red-700 p-3 rounded-lg mb-3"><p class="font-bold">⚠️ Forecast Alert</p><p>${discrepancyAlert.text}</p></div>`;
                }
            }

            if (forecastForThisWeek !== null) {
                const diff = actualThisWeek - forecastForThisWeek;
                const tolerance = forecastForThisWeek * 0.05; // 5% tolerance
                let comparisonText = '';
                if(Math.abs(diff) <= tolerance) {
                    comparisonText = `which was within the predicted range.`;
                } else {
                    comparisonText = `which is <strong>${Math.abs(diff).toLocaleString()} ${metricData.unit} ${diff > 0 ? 'higher' : 'lower'}</strong> than predicted.`;
                }
                analysisHTML += `<div class="bg-gray-100 p-3 rounded-lg mb-3"><p>We previously forecasted a value of <strong>${forecastForThisWeek.toLocaleString()}</strong> for this week. Your actual result was <strong>${actualThisWeek.toLocaleString()}</strong>, ${comparisonText}</p></div>`;
            }

            const futureAlert = getForecastAnalysis(metricData);
            if (futureAlert) {
                analysisHTML += `<div class="bg-yellow-100 border-l-4 border-yellow-400 text-yellow-800 p-3 rounded-md"><p class="font-bold">Future Outlook</p><p>${futureAlert}</p></div>`;
            }

            forecastAnalysisContainer.innerHTML = analysisHTML || '';
            forecastAnalysisContainer.style.display = analysisHTML ? 'block' : 'none';
            modal.style.display = 'block';
        }

        function closeModal() {
            modal.style.display = 'none';
        }
        window.onclick = function(event) {
            if (event.target == modal) closeModal();
        }

        // --- UI Generation Functions ---
        function getScoreColor(score, threshold, metric) {
            if (!threshold || !Array.isArray(threshold)) return 'text-blue-500';
            let value = score;
            if (metric === "Blood Pressure" && typeof score === 'string') value = parseInt(score.split('/')[0]);
            if(typeof value !== 'number') return 'text-blue-500';
            return (value < threshold[0] || value > threshold[1]) ? 'text-red-500' : 'text-green-500';
        }

        function getComparison(current, previous) {
            if (typeof current !== 'number' || typeof previous !== 'number') return `<span class="text-gray-500">vs ${previous} last week</span>`;
            const diff = current - previous;
            const sign = diff > 0 ? '+' : '';
            const color = diff > 0 ? 'text-green-500' : (diff < 0 ? 'text-red-500' : 'text-gray-500');
            return `<span class="${color}">${sign}${diff.toLocaleString()} vs last week</span>`;
        }
        
        function animateProgressBars() {
            document.querySelectorAll('.progress-ring-circle').forEach(circle => {
                const radius = circle.r.baseVal.value;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (parseInt(circle.dataset.percent, 10) / 100) * circumference;
                circle.style.strokeDasharray = `${circumference} ${circumference}`;
                setTimeout(() => { circle.style.strokeDashoffset = offset; }, 100);
            });
        }

        function createReportCard(data) {
            const scoreColor = getScoreColor(data.userScore, data.threshold, data.metric);
            const comparisonText = getComparison(data.userScore, data.previousScore);
            const futureAlertMessage = getForecastAnalysis(data);
            const discrepancyAlert = getForecastDiscrepancyAnalysis(data);
            
            let showWarning = false;
            let value = data.userScore;
            if (data.metric === "Blood Pressure" && typeof data.userScore === 'string') value = parseInt(data.userScore.split('/')[0]);
            if (data.threshold && typeof value === 'number') showWarning = value < data.threshold[0] || value > data.threshold[1];
            
            let userDisplay = '';
            if (typeof data.userScore === 'number' && (data.unit === 'Score' || data.unit === 'Positivity Score')) {
                userDisplay = `<div class="relative w-24 h-24"><svg class="w-full h-full" viewBox="0 0 100 100"><circle class="text-gray-200" stroke-width="8" stroke="currentColor" fill="transparent" r="42" cx="50" cy="50"/><circle class="progress-ring-circle ${scoreColor.replace('text-','stroke-')}" stroke-width="8" stroke-linecap="round" stroke="currentColor" fill="transparent" r="42" cx="50" cy="50" data-percent="${data.userScore}"/></svg><div class="absolute inset-0 flex flex-col items-center justify-center"><span class="text-2xl font-bold ${scoreColor}">${data.userScore}</span></div></div>`;
            } else {
                userDisplay = `<div class="text-center"><p class="text-3xl sm:text-4xl font-bold ${scoreColor}">${data.userScore}</p><p class="text-sm text-gray-500">${data.unit}</p></div>`;
            }

            return `
                <div class="bg-white rounded-xl shadow-md overflow-hidden p-6 flex flex-col transform hover:scale-105 transition-transform duration-300">
                    <div class="flex-grow">
                        <div class="flex items-center justify-between text-gray-500 mb-4">
                            <div class="flex items-center">${data.icon}<h2 class="ml-3 text-lg font-semibold text-gray-900">${data.metric}</h2></div>
                            <button onclick="showHistoryChart('${data.metric}')" class="text-sm font-medium text-indigo-600 hover:text-indigo-800 flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg> View Details</button>
                        </div>
                        <div class="flex flex-col sm:flex-row items-center justify-around gap-4 sm:gap-6 mb-4">
                            <div class="flex flex-col items-center">${userDisplay}<p class="text-sm font-medium mt-2">Your Score</p><p class="text-xs ${scoreColor}">${comparisonText}</p></div>
                            <div class="flex flex-col items-center text-center"><p class="text-3xl sm:text-4xl font-bold text-gray-400">${data.avgScore}</p><p class="text-sm text-gray-500">${data.unit}</p><p class="text-sm font-medium mt-2">Avg. People</p></div>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">${data.analysis}</p>
                    </div>

                    <div class="space-y-3 mt-auto">
                        ${showWarning && data.warning ? `
                            <div class="bg-red-50 border-l-4 border-red-400 text-red-700 p-4 rounded-md">
                                <div class="flex"><div class="py-1"><svg class="h-6 w-6 text-red-500 mr-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.03-1.742 3.03H4.42c-1.532 0-2.492-1.696-1.742-3.03l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd" /></svg></div>
                                <div><p class="font-bold">Wellness Alert</p><p class="text-sm">${data.warning}</p></div></div>
                            </div>` : ''}
                        
                        ${discrepancyAlert ? `
                             ${discrepancyAlert.isPositive ? `
                                <div class="bg-green-50 border-l-4 border-green-400 text-green-700 p-4 rounded-md">
                                    <div class="flex"><div class="py-1"><svg class="h-6 w-6 text-green-500 mr-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941" /></svg></div>
                                    <div><p class="font-bold">Positive Forecast</p><p class="text-sm">${discrepancyAlert.text}</p></div></div>
                                </div>
                            ` : `
                                <div class="bg-red-50 border-l-4 border-red-400 text-red-700 p-4 rounded-md">
                                    <div class="flex"><div class="py-1"><svg class="h-6 w-6 text-red-500 mr-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z" /></svg></div>
                                    <div><p class="font-bold">Forecast Alert</p><p class="text-sm">${discrepancyAlert.text}</p></div></div>
                                </div>
                            `}
                        ` : ''}

                        ${futureAlertMessage ? `
                            <div class="bg-yellow-100 border-l-4 border-yellow-400 text-yellow-800 p-4 rounded-md">
                                <div class="flex"><div class="py-1"><svg class="h-6 w-6 text-yellow-500 mr-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg></div>
                                <div><p class="font-bold">Future Outlook</p><p class="text-sm">${futureAlertMessage}</p></div></div>
                            </div>` : ''}
                    </div>
                </div>
            `;
        }
    </script>

</body>
</html>


